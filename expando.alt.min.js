var expando=function(){var k=function(){this.tag="div";this.id="";this.classList=[];this.children=[];this.literal=this.expansion=this.mods="";this.count=1};k.prototype.expand=function(){if(this.literal)return this.literal;for(var b="<"+this.tag+(this.id?' id="'+this.id+'"':"")+(this.classList.length?' class="'+this.classList.join(" ")+'"':"")+(this.mods?" "+this.mods:"")+">",d,c=-1;d=this.children[++c];)b+=d.expand();switch(this.tag.toLowerCase()){case "link":case "meta":case "img":case "area":case "source":case "br":case "basefront":case "col":case "hr":case "input":case "keygen":case "embed":case "keygen":case "param":case "source":case "track":case "wbr":break;
default:b+="</"+this.tag+">"}if(1<d.count)for(c=1;c<d.count;c++)b+=b;return b};var n=/\.([a-z][a-z0-9\-\_]*)/ig,p=/\#([a-z][a-z0-9\-\_]*)/ig,q=/^[\s]*([a-z]*)/ig,r=/\*([0-9]*)/ig,s=function(b){var d=-1,c=function(){for(var a=[],e=0,f="";f=b[++d];)switch(a[e]||(a[e]=new k),f){case "{":a[e].children.push.apply(a[e].children,c());a[e].expansion+=" ";break;case "}":return a;case "(":for(var g=!1,h=new k;(f=b[++d])&&(")"!==f||g);)h.literal+=f,g=g?!1:"\\"===f;a[e].children.push(h);a[e].expansion+=" ";break;
case "[":g=!1;for(h.mods+=" ";f=b[++d]&&("]"!==f||g);)h.mods+=f,g=g?!1:"\\"===f;a[e].expansion+=" ";break;case "+":e++;break;default:a[e].expansion+=f}return a};return c()},m=function(b){console.log("tree",b);for(var d=-1,c,a="";c=b[++d];)if(!b[d].literal){for(;a=n.exec(c.expansion);)c.classList.push(a[1]);if(a=c.expansion.match(p))c.id=a[0];if(a=c.expansion.match(q))c.tag=a[0];if(a=c.expansion.match(r))c.count=parseInt(a[0]);b[d].children.length&&m(c.children)}return b},l={expand:function(b){return l.parse(l.lex(b))},
lex:function(b){return m(s(b))},parse:function(b){for(var d,c="",a=-1;d=b[++a];)c+=d.expand();return c}};return l}();
