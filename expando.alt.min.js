var expando=function(){var k=function(){this.tag="div";this.id="";this.classList=[];this.children=[];this.literal=this.expansion=this.mods="";this.count=1};k.prototype.expand=function(){if(this.literal)return this.literal;for(var b="<"+this.tag+(this.id?' id="'+this.id+'"':"")+(this.classList.length?' class="'+this.classList.join(" ")+'"':"")+(this.mods?" "+this.mods:"")+">",e,c=-1;e=this.children[++c];)b+=e.expand();switch(this.tag.toLowerCase()){case "link":case "meta":case "img":case "area":case "source":case "br":case "basefront":case "col":case "hr":case "input":case "keygen":case "embed":case "keygen":case "param":case "source":case "track":case "wbr":break;
default:b+="</"+this.tag+">"}if(1<this.count)for(c=1;c<this.count;c++)b+=b;return b};var n=/\.([a-z][a-z0-9\-\_]*)/ig,p=/\#([a-z][a-z0-9\-\_]*)/ig,q=/^[\s]*([a-z]*)/ig,r=/\*([0-9]*)/ig,s=function(b){var e=-1,c=function(){for(var a=[],d=0,f="";f=b[++e];)switch(a[d]||(a[d]=new k),f){case "{":a[d].children.push.apply(a[d].children,c());a[d].expansion+=" ";break;case "}":return a;case "(":for(var g=!1,h=new k;(f=b[++e])&&(")"!==f||g);)h.literal+=f,g=g?!1:"\\"===f;a[d].children.push(h);a[d].expansion+=
" ";break;case "[":g=!1;for(h.mods+=" ";f=b[++e]&&("]"!==f||g);)h.mods+=f,g=g?!1:"\\"===f;a[d].expansion+=" ";break;case "+":d++;break;default:a[d].expansion+=f}return a};return c()},m=function(b){console.log("tree",b);for(var e=-1,c,a="";c=b[++e];)if(!b[e].literal){for(;a=n.exec(c.expansion);)c.classList.push(a[1]);if(a=c.expansion.match(p))c.id=a[0];if(a=c.expansion.match(q))c.tag=a[0];if(a=c.expansion.match(r))c.count=parseInt(a[0]);b[e].children.length&&m(c.children)}return b},l={expand:function(b){return l.parse(l.lex(b))},
lex:function(b){return m(s(b))},parse:function(b){for(var e,c="",a=-1;e=b[++a];)c+=e.expand();return c}};return l}();
