var expando=function(){var a=function(){this.tag="div",this.id="",this.classList=[],this.children=[],this.mods="",this.expansion="",this.literal="",this.count=1};a.prototype.expand=function(){if(this.literal)return this.literal;for(var b,a="<"+this.tag+(this.id?' id="'+this.id+'"':"")+(this.classList.length?' class="'+this.classList.join(" ")+'"':"")+(this.mods?" "+this.mods:"")+">",c=-1;b=this.children[++c];)a+=b.expand();switch(this.tag.toLowerCase()){case"link":case"meta":case"img":case"area":case"source":case"br":case"basefront":case"col":case"hr":case"input":case"keygen":case"embed":case"keygen":case"param":case"source":case"track":case"wbr":break;default:a+="</"+this.tag+">"}if(this.count>1)for(var c=1;c<this.count;c++)a+=a;return a};var b={cls:/\.([a-z][a-z0-9\-\_]*)/gi,id:/\#([a-z][a-z0-9\-\_]*)/gi,tag:/^[\s]*([a-z]*)/gi,cnt:/\*([0-9]*)/gi},c=function(b){var c=-1,d=function(){for(var e=[],f=0,g="";g=b[++c];)switch(e[f]||(e[f]=new a),g){case"{":e[f].children.push.apply(e[f].children,d()),e[f].expansion+=" ";break;case"}":return e;case"(":for(var h=!1,i=new a;(g=b[++c])&&(")"!==g||h);)i.literal+=g,h=h?!1:"\\"===g;e[f].children.push(i),e[f].expansion+=" ";break;case"[":var h=!1;for(i.mods+=" ";g=b[++c]&&("]"!==g||h);)i.mods+=g,h=h?!1:"\\"===g;e[f].expansion+=" ";break;case"+":f++;break;default:e[f].expansion+=g}return e};return d()},d=function(a){console.log("tree",a);for(var e,c=-1,f="";e=a[++c];)if(!a[c].literal){for(;f=b.cls.exec(e.expansion);)e.classList.push(f[1]);(f=e.expansion.match(b.id))&&(e.id=f[0]),(f=e.expansion.match(b.tag))&&(e.tag=f[0]),(f=e.expansion.match(b.cnt))&&(e.count=parseInt(f[0])),a[c].children.length&&d(e.children)}return a},e={expand:function(a){return e.parse(e.lex(a))},lex:function(a){return d(c(a))},parse:function(a){for(var b,c="",d=-1;b=a[++d];)c+=b.expand();return c}};return e}();
